{% load static %}
<!DOCTYPE html>
<html lang="ro">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>{{ pet.nume }} | Adopt a Pet</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
		<link rel="stylesheet" href="{% static 'css/style.css' %}" type="text/css" media="screen" />
		<link rel="stylesheet" href="{% static 'includes/js/flexslider.css' %}" type="text/css" media="all" />
		<link rel="stylesheet" href="{% static 'includes/fancybox/jquery.fancybox.css' %}" type="text/css" media="screen" />
		<link rel="shortcut icon" href="{% static 'images/favicon.png' %}" />
	</head>
	<body class="content_left scheme_red">
		<section id="main_wrap">
			<header class="wrapper" id="header">
				<div class="container">
					<div id="main_menu" class="clearfix">
						<div class="clearfix">
							<a href="{% url 'home' %}" title="Adopt a Pet" class="the_logo_link">
								<img src="{% static 'images/eu-adopt-logo-original.jpeg' %}" alt="EU Adopt" id="logo" height="40" />
							</a>
							<nav id="menu_wrap">
								<div class="menu-main-menu-container">
									<ul id="menu-main-menu" class="menu">
										<li><a href="{% url 'home' %}">Acasă</a></li>
										<li><a href="{% url 'pets_all' %}">Animale</a></li>
										<li><a href="{% url 'contact' %}">Contact</a></li>
										<li><a href="{% url 'login' %}">Logare</a></li>
										<li><a href="{% url 'register' %}">Înregistrare</a></li>
									</ul>
								</div>
							</nav>
						</div>
					</div>
				</div>
			</header>
			<section class="wrapper" id="main_content">
				<div class="container clearfix">
					<div class="posts-wrap">
						<section class="page">
							<h2 class="entry-title">{{ pet.nume }}</h2>
							<div class="entry-content clearfix">
								<div class="pet-single-detail clearfix">
									<div class="pet-image">
										{% if pet.imagine %}
											<img src="{{ pet.imagine.url }}" alt="{{ pet.nume }}" class="attachment-pet_single_large" width="275" height="275" onerror="this.src='{% static 'images/pets/charlie-275x275.jpg' %}';this.onerror=null;" />
										{% elif pet.imagine_fallback %}
											<img src="{% static pet.imagine_fallback %}" alt="{{ pet.nume }}" class="attachment-pet_single_large" width="275" height="275" />
										{% else %}
											<img src="{% static 'images/pets/charlie-275x275.jpg' %}" alt="{{ pet.nume }}" class="attachment-pet_single_large" width="275" height="275" />
										{% endif %}
										{% with page_url=request.build_absolute_uri %}
										{% with share_text="Vezi acest animal pentru adopție pe EU-ADOPT:" %}
										{% with email_subject="EU-ADOPT – Animal pentru adopție" %}
										{% with email_body=share_text|add:" "|add:page_url %}
										<div class="share-bar">
											<h5 class="share-bar-label">Distribuie</h5>
											<a href="https://api.whatsapp.com/send?text={{ share_text|urlencode }}%20{{ page_url|urlencode }}" target="_blank" rel="noopener noreferrer" class="share-btn share-wa" title="WhatsApp">WhatsApp</a>
											<a href="https://www.facebook.com/sharer/sharer.php?u={{ page_url|urlencode }}" target="_blank" rel="noopener noreferrer" class="share-btn share-fb" title="Facebook">Facebook</a>
											<a href="mailto:?subject={{ email_subject|urlencode }}&body={{ email_body|urlencode }}" class="share-btn share-mail" title="Trimite pe email">Email</a>
											<button type="button" class="share-btn share-copy" id="copyLinkBtn" title="Copiază link">Copiază link</button>
											<div class="share-bar-note">Pentru Instagram/TikTok: apasă „Copiază link” și lipește în postare/Story.</div>
										</div>
										{% endwith %}
										{% endwith %}
										{% endwith %}
										{% endwith %}
									</div>
									<div class="pet-info">
										<div class="breed">{{ pet.get_tip_display }} – {{ pet.rasa }} – {{ pet.get_varsta_display }} – {{ pet.get_sex_display }}{% if pet.marime %} – {{ pet.get_marime_display }}{% endif %}</div>
										<div class="pet_info clearfix">
											<span>{{ pet.get_status_display }}</span>
											{% if pet.tags %}{{ pet.tags }}{% endif %}
										</div>
										{% if pet.descriere %}
											<p>{{ pet.descriere|linebreaks }}</p>
										{% endif %}
									</div>
								</div>

								{% if messages %}
								<ul class="adoption-messages">
									{% for message in messages %}
									<li class="message-{{ message.tags }}">{{ message }}</li>
									{% endfor %}
								</ul>
								{% endif %}

								{% if pet.status == 'adoptable' %}
								<h3>Formular de adopție</h3>
								<form method="post" action="{% url 'adoption_request_submit' pet.pk %}" class="adoption-form">
									{% csrf_token %}
									{{ adoption_form.as_p }}
									<p><button type="submit" class="button">Trimite cererea</button></p>
								</form>
								{% else %}
								<p>Acest animal nu mai este disponibil pentru adopție.</p>
								{% endif %}
							</div>
						</section>
					</div>
				</div>
			</section>
			<footer id="footer" class="wrapper">
				<div class="container">
					<div id="post_footer">
						<div id="site_info" class="clearfix">
							<div class="right">&copy; Adopt a Pet</div>
						</div>
					</div>
				</div>
			</footer>
		</section>
		{% with page_url=request.build_absolute_uri %}
		<script>
		(function() {
			const pageUrl = "{{ page_url|escapejs }}";
			const btn = document.getElementById("copyLinkBtn");
			if (!btn) return;
			btn.addEventListener("click", async function() {
				try {
					await navigator.clipboard.writeText(pageUrl);
					const old = btn.textContent;
					btn.textContent = "Copiat!";
					setTimeout(function() { btn.textContent = old; }, 1200);
				} catch (e) {
					// fallback
					var ta = document.createElement('textarea');
					ta.value = pageUrl;
					ta.style.position = 'fixed';
					ta.style.left = '-9999px';
					document.body.appendChild(ta);
					ta.select();
					try {
						document.execCommand('copy');
						var old = btn.textContent;
						btn.textContent = 'Copiat!';
						setTimeout(function() { btn.textContent = old; }, 1200);
					} finally {
						document.body.removeChild(ta);
					}
				}
			});
		})();
		</script>
		{% endwith %}
	</body>
</html>
