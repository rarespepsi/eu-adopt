{% extends "base.html" %}
{% load static %}

{% block title %}EU Adopt ‚Äì AcasƒÉ{% endblock %}

{% block body_class %}page-home{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home-skeleton.css' %}" type="text/css" media="all" />
<link rel="stylesheet" href="{% static 'includes/js/flexslider.css' %}" type="text/css" media="all" />
<link rel="stylesheet" href="{% static 'includes/fancybox/jquery.fancybox.css' %}" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Merriweather:300" rel="stylesheet" type="text/css" media="print" onload="this.media='all'" />
<link rel="stylesheet" href="{% static 'css/home-sidebar-compact.css' %}" type="text/css" media="all" />
{% endblock %}

{% block content %}
<!-- Widget Concurs - fix pe partea st√¢ngƒÉ -->
{% if contest %}
<div id="contest_widget" class="contest-widget-fixed" data-contest-end="{{ contest.end_date|date:'c' }}">
	<div class="contest-widget-content">
		<div class="contest-header" id="contestHeader">
			<h2 class="contest-title">üêæ CONCURS EU-ADOPT</h2>
			<div class="contest-countdown" id="contestCountdown">
				Mai sunt <span id="remainingDays">{{ remaining_days }}</span> zile
			</div>
			<div class="contest-dog-animation" id="contestDogAnimation">
				<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" class="dog-svg">
					<ellipse cx="50" cy="60" rx="25" ry="20" fill="#8B4513" class="dog-body"/>
					<circle cx="50" cy="35" r="18" fill="#D2691E" class="dog-head"/>
					<ellipse cx="38" cy="25" rx="6" ry="12" fill="#654321" class="dog-ear dog-ear-left"/>
					<ellipse cx="62" cy="25" rx="6" ry="12" fill="#654321" class="dog-ear dog-ear-right"/>
					<circle cx="45" cy="32" r="2" fill="#000" class="dog-eye dog-eye-left"/>
					<circle cx="55" cy="32" r="2" fill="#000" class="dog-eye dog-eye-right"/>
					<ellipse cx="50" cy="38" rx="2" ry="1.5" fill="#000" class="dog-nose"/>
					<ellipse cx="50" cy="75" rx="8" ry="6" fill="#654321" class="dog-paw"/>
					<path d="M 50 85 L 50 95 L 45 90 Z" fill="#d32f2f" opacity="0.6" class="attention-pointer"/>
				</svg>
			</div>
		</div>
		<div class="contest-prize-section" id="contestPrizeSection" style="display: none;">
			{% if contest.prize_image %}
			<img src="{{ contest.prize_image.url }}" alt="{{ contest.prize_title|default:'Premiul concursului' }}" class="contest-prize-image" loading="lazy" />
			{% endif %}
			<div class="contest-prize-text">Premiul concursului</div>
		</div>
		<div class="contest-leaderboard">
			<h3 class="leaderboard-title">Top 10</h3>
			<div class="leaderboard-scroll">
				<ul class="leaderboard-list">
					{% for entry in top_users %}
					<li class="leaderboard-item">
						<span class="leaderboard-position">{{ entry.position }}.</span>
						<span class="leaderboard-username">{{ entry.user.username }}</span>
						<span class="leaderboard-points">‚Äî {{ entry.points }} puncte</span>
					</li>
					{% empty %}
					<li class="leaderboard-item">Niciun participant √ÆncƒÉ</li>
					{% endfor %}
				</ul>
			</div>
		</div>
	</div>
</div>
{% endif %}
<!-- CENTER CONTENT - Scrollable -->
<div class="container clearfix home_page_sections">
	<!-- Center stack wrapper for A1-A5 -->
	<div class="center-stack">
	<!-- A1 - Banda cursivƒÉ animale (sub navbar) - INSIDE center container -->
	<div id="A1" class="slot-container slot" data-slot="A1">
		<div id="burtiera_mica" class="burtiera_mica_wrap">
			<div class="burtiera_mica_track">
				{% for pet in strip_pets %}
				<a href="{% url 'pets_single' pet.pk %}" class="burtiera_mica_img" title="{{ pet.nume }}" data-pet-id="{{ pet.pk }}" data-pet-status="{{ pet.status }}">
					{% if pet.imagine %}
					<img src="{{ pet.imagine.url }}" alt="{{ pet.nume }}" onerror="this.src='{% static 'images/pets/charlie-400x200.jpg' %}';this.onerror=null;" />
					{% elif pet.imagine_fallback %}
					<img src="{% static pet.imagine_fallback %}" alt="{{ pet.nume }}" />
					{% else %}
					<img src="{% static 'images/pets/charlie-400x200.jpg' %}" alt="{{ pet.nume }}" />
					{% endif %}
					<!-- Status overlay -->
					{% if pet.status == "adoptable" %}
					<div class="status-overlay status-active" title="Disponibil pentru adop»õie">
						<div class="status-animation-bone"></div>
					</div>
					{% elif pet.status == "adopted" %}
					<div class="status-overlay status-adopted" title="Adoptat">
						<div class="status-badge-adopted">ADOPTAT</div>
						<div class="status-animation-hearts"></div>
					</div>
					{% elif pet.status == "pending" %}
					<div class="status-overlay status-pending" title="√én procedurƒÉ">
						<div class="status-badge-pending">√éN PROCEDURƒÇ</div>
					</div>
					{% endif %}
				</a>
				{% empty %}
				{% for i in "123456789012" %}
				<a href="{% url 'pets_all' %}" class="burtiera_mica_img"><img src="{% static 'images/pets/charlie-400x200.jpg' %}" alt="Animale" /></a>
				{% endfor %}
				{% endfor %}
				{% for pet in strip_pets %}
				<a href="{% url 'pets_single' pet.pk %}" class="burtiera_mica_img" title="{{ pet.nume }}" data-pet-id="{{ pet.pk }}" data-pet-status="{{ pet.status }}">
					{% if pet.imagine %}
					<img src="{{ pet.imagine.url }}" alt="{{ pet.nume }}" onerror="this.src='{% static 'images/pets/charlie-400x200.jpg' %}';this.onerror=null;" />
					{% elif pet.imagine_fallback %}
					<img src="{% static pet.imagine_fallback %}" alt="{{ pet.nume }}" />
					{% else %}
					<img src="{% static 'images/pets/charlie-400x200.jpg' %}" alt="{{ pet.nume }}" />
					{% endif %}
					<!-- Status overlay -->
					{% if pet.status == "adoptable" %}
					<div class="status-overlay status-active" title="Disponibil pentru adop»õie">
						<div class="status-animation-bone"></div>
					</div>
					{% elif pet.status == "adopted" %}
					<div class="status-overlay status-adopted" title="Adoptat">
						<div class="status-badge-adopted">ADOPTAT</div>
						<div class="status-animation-hearts"></div>
					</div>
					{% elif pet.status == "pending" %}
					<div class="status-overlay status-pending" title="√én procedurƒÉ">
						<div class="status-badge-pending">√éN PROCEDURƒÇ</div>
					</div>
					{% endif %}
				</a>
				{% empty %}
				{% for i in "123456789012" %}
				<a href="{% url 'pets_all' %}" class="burtiera_mica_img"><img src="{% static 'images/pets/charlie-400x200.jpg' %}" alt="Animale" /></a>
				{% endfor %}
				{% endfor %}
			</div>
		</div>
	</div>
	<!-- A2 - Banner prezentare + siglƒÉ -->
	<div id="A2" class="slot-container slot" data-slot="A2">
		<div id="slider_wrap">
			<div class="hero-logo">
				<a href="{% url 'home' %}" title="EU Adopt" class="the_logo_link">
					<img src="{% static 'images/eu-adopt-logo-original.jpeg' %}" alt="EU Adopt" id="logo_hero" />
				</a>
			</div>
			<ul class="slides">
				<li class="slide_image_wrap">
					<img width="2880" height="1000" src="{% static 'images/slide1.jpg' %}" alt="Slide 1" onerror="this.src='{% static 'images/pets/charlie-400x200.jpg' %}';this.onerror=null;" />
				</li>
				<li class="slide_image_wrap">
					<img width="2880" height="1000" src="{% static 'images/slide2.jpg' %}" alt="Slide 2" onerror="this.src='{% static 'images/pets/charlie-400x200.jpg' %}';this.onerror=null;" />
				</li>
				<li class="slide_image_wrap">
					<img width="2880" height="1000" src="{% static 'images/slide3.jpg' %}" alt="Slide 3" onerror="this.src='{% static 'images/pets/charlie-400x200.jpg' %}';this.onerror=null;" />
				</li>
			</ul>
		</div>
	</div>
	
	<!-- A3 - "Animalele lunii" (grid 2 r√¢nduri x 3 coloane) -->
	<div id="A3" class="slot-container slot" data-slot="A3">
		<div id="featured_pets">
			<h3>Animalele lunii</h3>
			<div id="featured_inner" class="clearfix featured-grid-2x3">
				{% for pet in featured_pets %}
				<div class="single_pet featured-pet-card" data-pet-id="{{ pet.pk }}" data-pet-status="{{ pet.status }}">
					<a href="{% url 'pets_single' pet.pk %}" title="{{ pet.nume }}">
						{% if pet.imagine %}
						<img width="400" height="200" src="{{ pet.imagine.url }}" class="attachment-pet_month" alt="{{ pet.nume }}" onerror="this.src='{% static 'images/pets/charlie-400x200.jpg' %}';this.onerror=null;" />
						{% elif pet.imagine_fallback %}
						<img width="400" height="200" src="{% static pet.imagine_fallback %}" class="attachment-pet_month" alt="{{ pet.nume }}" />
						{% else %}
						<img width="400" height="200" src="{% static 'images/pets/charlie-400x200.jpg' %}" class="attachment-pet_month" alt="{{ pet.nume }}" />
						{% endif %}
						<!-- Status overlay -->
						{% if pet.status == "adoptable" %}
						<div class="status-overlay status-active">
							<div class="status-animation-bone"></div>
						</div>
						{% elif pet.status == "adopted" %}
						<div class="status-overlay status-adopted">
							<div class="status-badge-adopted">ADOPTAT</div>
							<div class="status-animation-hearts"></div>
						</div>
						{% elif pet.status == "pending" %}
						<div class="status-overlay status-pending">
							<div class="status-badge-pending">√éN PROCEDURƒÇ</div>
						</div>
						{% endif %}
					</a>
					<div class="mask">
						<h2>{{ pet.nume }}</h2>
						<p>{% if pet.descriere %}{{ pet.descriere|truncatewords:15 }}{% else %}Cunoa»ôte-l pe {{ pet.nume }}{% endif %}</p>
						<a href="{% url 'pets_single' pet.pk %}" title="{{ pet.nume }}" class="more_featured">AflƒÉ mai multe</a>
					</div>
				</div>
				{% empty %}
				<div class="single_pet featured-pet-card">
					<a href="{% url 'pets_all' %}" title="Animale">
						<img width="400" height="200" src="{% static 'images/pets/charlie-400x200.jpg' %}" class="attachment-pet_month" alt="Animale" />
					</a>
					<div class="mask">
						<h2>Animale disponibile</h2>
						<p>ViziteazƒÉ galeria noastrƒÉ</p>
						<a href="{% url 'pets_all' %}" class="more_featured">Vezi toate animalele</a>
					</div>
				</div>
				{% endfor %}
			</div>
		</div>
	</div>
	
	<!-- A4 - "New Entry" / cele mai noi animale (grid principal scroll) -->
	<div id="A4" class="slot-container slot" data-slot="A4">
		<div id="new_entries_grid" class="new-entries-grid-7cols">
			{% for pet in new_entries %}
			<div class="new-entry-card" data-pet-id="{{ pet.pk }}" data-pet-status="{{ pet.status }}">
				<a href="{% url 'pets_single' pet.pk %}" title="{{ pet.nume }}">
					{% if pet.imagine %}
					<img src="{{ pet.imagine.url }}" alt="{{ pet.nume }}" onerror="this.src='{% static 'images/pets/charlie-180x180.jpg' %}';this.onerror=null;" />
					{% elif pet.imagine_fallback %}
					<img src="{% static pet.imagine_fallback %}" alt="{{ pet.nume }}" />
					{% else %}
					<img src="{% static 'images/pets/charlie-180x180.jpg' %}" alt="{{ pet.nume }}" />
					{% endif %}
					<!-- Status overlay -->
					{% if pet.status == "adoptable" %}
					<div class="status-overlay status-active">
						<div class="status-animation-bone"></div>
					</div>
					{% elif pet.status == "adopted" %}
					<div class="status-overlay status-adopted">
						<div class="status-badge-adopted">ADOPTAT</div>
						<div class="status-animation-hearts"></div>
					</div>
					{% elif pet.status == "pending" %}
					<div class="status-overlay status-pending">
						<div class="status-badge-pending">√éN PROCEDURƒÇ</div>
					</div>
					{% elif pet.status == "showcase_archive" %}
					<div class="status-overlay status-archive">
						<div class="status-badge-archive">POVESTE</div>
					</div>
					{% endif %}
					<div class="pet-name-overlay">{{ pet.nume }}</div>
				</a>
			</div>
			{% empty %}
			<p style="clear:both; padding-top:10px;">Momentan nu existƒÉ animale. <a href="{% url 'pets_all' %}">Vezi toate</a>.</p>
			{% endfor %}
		</div>
	</div>
	
	<!-- A5 - BurtierƒÉ parteneri (logo + linkuri) -->
	<div id="A5" class="slot-container slot" data-slot="A5">
		<!-- Slot A5 content - suport: imagine / video / anima»õie -->
	</div>
	</div>
	<!-- End center-stack wrapper -->
</div>
{% endblock %}

{% block extra_js %}
<script type="text/javascript" src="{% static 'includes/js/jquery-1.11.1.min.js' %}"></script>
<script type="text/javascript" src="{% static 'includes/fancybox/jquery.fancybox.js' %}"></script>
<script type="text/javascript" src="{% static 'includes/js/jquery.flexslider-min.js' %}"></script>
<script type="text/javascript" src="{% static 'includes/js/jquery.mobilemenu.js' %}"></script>
<script type="text/javascript" src="{% static 'includes/js/rescue.js' %}"></script>
<script type="text/javascript">
// VIP Stacked Mode Toggle
// To activate VIP mode, add class 'vip-mode' to body: document.body.classList.add('vip-mode')
// To deactivate: document.body.classList.remove('vip-mode')
// VIP mode merges: LEFT (A9+A10+A11), RIGHT (A15+A16+A17)
(function() {
	'use strict';
	// VIP mode can be activated by adding 'vip-mode' class to body
	// Example: document.body.classList.add('vip-mode');
	console.log('Slot system A0-A17 initialized. VIP mode: add class "vip-mode" to body.');
})();

// Calculate A0 + A1 height dynamically for sticky sidebars
(function() {
	'use strict';
	if (document.body.classList.contains('page-home')) {
		// A0 is fixed at 70px height
		document.documentElement.style.setProperty('--a0-height', '70px');
		
		// A1 is fixed at 56px height (comfortable fixed height)
		document.documentElement.style.setProperty('--a1-height', '56px');
		
		// Calculate total header height
		var a0Height = 70;
		var a1Height = 56;
		var totalHeight = a0Height + a1Height;
		document.documentElement.style.setProperty('--header-total-height', totalHeight + 'px');
	}
})();

// Adoption Celebration Animation (ONCE PER SESSION)
(function() {
	'use strict';
	
	// Check if celebration already shown in this session
	var celebrationShown = sessionStorage.getItem('adoptionCelebrationShown');
	if (celebrationShown === 'true') {
		// Already shown - just add green frames to adopted cards
		document.querySelectorAll('[data-pet-status="adopted"]').forEach(function(card) {
			if (!card.querySelector('.adopted-card-frame')) {
				var frame = document.createElement('div');
				frame.className = 'adopted-card-frame';
				card.appendChild(frame);
			}
		});
		return;
	}
	
	// Check if there are adopted animals on the page
	var adoptedCards = document.querySelectorAll('[data-pet-status="adopted"]');
	if (adoptedCards.length === 0) {
		return; // No adopted animals, no celebration
	}
	
	// Show big celebration animation ONCE
	var celebration = document.createElement('div');
	celebration.className = 'adoption-celebration';
	celebration.innerHTML = '<div class="adoption-celebration-content">' +
		'<div class="celebration-icon">üéâ</div>' +
		'<h2>FelicitƒÉri!</h2>' +
		'<p>Un animal a fost adoptat!</p>' +
		'<p style="font-size: 16px; opacity: 0.9;">Mul»õumim pentru cƒÉ ai fƒÉcut diferen»õa!</p>' +
		'</div>';
	
	document.body.appendChild(celebration);
	
	// Mark as shown in session
	sessionStorage.setItem('adoptionCelebrationShown', 'true');
	
	// Remove celebration after 4 seconds
	setTimeout(function() {
		celebration.style.animation = 'fade-in-celebration 0.5s ease-in reverse';
		setTimeout(function() {
			if (celebration.parentNode) {
				celebration.parentNode.removeChild(celebration);
			}
		}, 500);
	}, 4000);
	
	// Add green frames to all adopted cards (after celebration)
	setTimeout(function() {
		adoptedCards.forEach(function(card) {
			if (!card.querySelector('.adopted-card-frame')) {
				var frame = document.createElement('div');
				frame.className = 'adopted-card-frame';
				card.appendChild(frame);
			}
		});
	}, 4500);
})();
</script>
{% if contest %}
<script>
(function() {
	'use strict';
	var widget = document.getElementById('contest_widget');
	if (!widget) return;
	var headerSection = document.querySelector('.contest-header');
	var prizeSection = document.getElementById('contestPrizeSection');
	var remainingDaysEl = document.getElementById('remainingDays');
	var dogAnimation = document.getElementById('contestDogAnimation');
	if (!headerSection || !prizeSection || !remainingDaysEl) return;
	var showPrize = false;
	var contestEndDate = new Date(widget.getAttribute('data-contest-end'));
	var pulseInterval = null, contentInterval = null, countdownInterval = null, isTabActive = true;
	document.addEventListener('visibilitychange', function() {
		isTabActive = !document.hidden;
		if (isTabActive) resumeAnimations(); else pauseAnimations();
	});
	function pauseAnimations() { if (dogAnimation) dogAnimation.style.animationPlayState = 'paused'; }
	function resumeAnimations() { if (dogAnimation) dogAnimation.style.animationPlayState = 'running'; }
	function calculateRemainingDays() {
		var diff = contestEndDate - new Date();
		return diff <= 0 ? 0 : Math.ceil(diff / (1000 * 60 * 60 * 24));
	}
	function updateCountdown() {
		if (!isTabActive) return;
		if (remainingDaysEl) remainingDaysEl.textContent = calculateRemainingDays();
	}
	function toggleContent() {
		if (!isTabActive) return;
		if (showPrize) {
			prizeSection.classList.remove('show');
			setTimeout(function() {
				prizeSection.style.display = 'none';
				headerSection.classList.remove('hidden');
				headerSection.style.display = 'block';
			}, 500);
		} else {
			headerSection.classList.add('hidden');
			setTimeout(function() {
				headerSection.style.display = 'none';
				prizeSection.style.display = 'block';
				setTimeout(function() { prizeSection.classList.add('show'); }, 50);
			}, 500);
		}
		showPrize = !showPrize;
	}
	function triggerPulse() {
		if (!isTabActive) return;
		widget.classList.add('pulse');
		setTimeout(function() { widget.classList.remove('pulse'); }, 600);
	}
	function initDogAnimation() {
		if (!dogAnimation) return;
		if ('IntersectionObserver' in window) {
			var observer = new IntersectionObserver(function(entries) {
				entries.forEach(function(entry) {
					if (entry.isIntersecting) dogAnimation.style.opacity = '1';
				});
			}, { threshold: 0.1 });
			observer.observe(dogAnimation);
			dogAnimation.style.opacity = '0';
			dogAnimation.style.transition = 'opacity 0.5s ease';
		}
	}
	updateCountdown();
	initDogAnimation();
	contentInterval = setInterval(toggleContent, 5000);
	countdownInterval = setInterval(updateCountdown, 3600000);
	pulseInterval = setInterval(triggerPulse, 15000);
	window.addEventListener('beforeunload', function() {
		if (contentInterval) clearInterval(contentInterval);
		if (countdownInterval) clearInterval(countdownInterval);
		if (pulseInterval) clearInterval(pulseInterval);
	});
})();
</script>
{% endif %}

<!-- HOME Layout Measurement Script -->
<script>
// Run: measureHomeLayout() in console
(function() {
	if (typeof window.measureHomeLayout === 'undefined') {
		window.measureHomeLayout = function() {
			console.clear();
			const px = n => Math.round(n) + "px";
			const r = el => el ? el.getBoundingClientRect() : null;

			const viewportW = window.innerWidth;
			const viewportH = window.innerHeight;

			const A1 = document.querySelector("#A1");
			const A2 = document.querySelector("#A2");
			const left = document.querySelector("#A6")?.closest(".sidebar-left") || 
			             document.querySelector(".sidebar-left") || null;
			const right = document.querySelector("#A12")?.closest(".sidebar-right") || 
			              document.querySelector(".sidebar-right") || null;
			const center = A1?.closest(".main-content") || 
			               document.querySelector(".main-content") || null;
			const wrapper = center?.parentElement || 
			                document.querySelector("#main_content .layout") || null;

			function logBox(name, el){
				if(!el){ console.log(name + ": NOT FOUND"); return; }
				const b = r(el);
				const cs = getComputedStyle(el);
				console.log(name, {
					w: px(b.width), 
					h: px(b.height),
					ml: cs.marginLeft, 
					mr: cs.marginRight,
					pl: cs.paddingLeft, 
					pr: cs.paddingRight,
					display: cs.display, 
					position: cs.position,
					left: px(b.left),
					right: px(b.right)
				});
			}

			console.log("=== HOME LAYOUT MEASUREMENT ===");
			console.log("Viewport:", viewportW+"px √ó "+viewportH+"px");
			console.log("");

			logBox("WRAPPER (.layout)", wrapper);
			logBox("LEFT (.sidebar-left)", left);
			logBox("CENTER (.main-content)", center);
			logBox("RIGHT (.sidebar-right)", right);
			logBox("A1", A1);
			logBox("A2", A2);

			// Calculate sum
			if (left && center && right) {
				const leftW = r(left).width;
				const centerW = r(center).width;
				const rightW = r(right).width;
				const wrapperW = wrapper ? r(wrapper).width : 0;
				const sum = leftW + centerW + rightW;
				
				console.log("");
				console.log("=== CALCULATION ===");
				console.log("Left width:", px(leftW));
				console.log("Center width:", px(centerW));
				console.log("Right width:", px(rightW));
				console.log("Sum (left + center + right):", px(sum));
				console.log("Wrapper width:", px(wrapperW));
				console.log("Difference:", px(wrapperW - sum));
				console.log("Viewport width:", px(viewportW));
			}
		};
		console.log("‚úÖ Measurement function loaded. Run: measureHomeLayout()");
	}
})();
</script>
{% endblock %}
